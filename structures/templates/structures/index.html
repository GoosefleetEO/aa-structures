{% extends 'structures/base.html' %}
{% load i18n %}
{% load humanize %}
{% load static %}

{% block details %}
    
    <div class="panel panel-primary">   
        <div class="panel-heading">
            <h3 class="panel-title">Structure List</h3>
        </div>
        <div class="panel-body">        
            <div class="table-responsive">                 
                <table id="tab_structures" style="width: 100%" class="table table-striped table-compact">
                    <thead>
                        <tr>            
                            <th></th>
                            <th>Owner</th>
                            <th>Location</th>                    
                            <th></th>
                            <th>Type</th>
                            <th>Name</th>
                            <th>Services</th>
                            <th>Reinforcement</th>
                            <th>Fuel Expires</th>
                            <th>State</th>
                        </tr>
                    </thead>        
                </table>
            </div>
        </div>
    </div>
    {% if perms.structures.add_structure_owner %}
        <a class="btn btn-default navbar-btn pull-right" href="{% url 'structures:add_structure_owner' %}">
            Add Structure Owner
        </a>
    {% endif %} 
    <p class="text-muted">
        All dates are EVE time • Offline services are shown with as <del>name</del>
            • Reinforced structures (except POCOs) are highlighted in red
            • Data can be outdated by up to 1 hour due to API caching.
    </p>
    
{% endblock %}

{% block extra_javascript %}
    {% include 'bundles/datatables-js.html' %}
    
    <!-- Start filterDropDown-js -->
    <script 
        type="text/javascript" 
        src="{% static 'structures/filterDropDown.min.js' %}">
    </script>
    <!-- End filterDropDown-js -->
{% endblock %}

{% block extra_css %}
    {% include 'bundles/datatables-css.html' %}
    <link 
        rel="stylesheet" 
        href="{% static 'structures/index.css' %}" 
        type="text/css" 
        media="screen"
    >
    
{% endblock %}

{% block extra_script %}
    $(document).ready(function(){
        $('#tab_structures').DataTable({
                        
            ajax: {
                url: '{% url 'structures:structure_list_data' %}',
                dataSrc: '',
                cache: false
            },

            columns: [
                { data: 'corporation_icon' },
                { data: 'owner' },
                { data: 'location' },
                { data: 'type_icon' },
                { data: 'type' },
                { data: 'structure_name_short' },
                { data: 'services' },
                { data: 'reinforcement' },
                { data: 'fuel_expires' },
                { data: 'state_details' },

                { data: 'alliance_name' },
                { data: 'corporation_name' },
                { data: 'region_name' },
                { data: 'solar_system_name' },
                { data: 'type_name' },
                { data: 'is_reinforced_str' },                
                { data: 'state_str' },
                { data: 'is_low_power_str' }
            ],
                        
            lengthMenu: [[7, 15, 25, 50, -1], [7, 15, 25, 50, "All"]],
            
            columnDefs: [
                { "sortable": false, "targets": [0, 3, 4, 6] },
                { "visible": false, "targets": [10, 11, 12, 13, 14, 15, 16, 17] },
            ],
            
            order: [ [ 1, "asc" ], [ 5, "asc" ] ],
            
            filterDropDown:
            {
                columns: [                                       
                    {
                        idx: 10,
                        title: 'Alliance'
                    },
                    {
                        idx: 11,
                        title: 'Corporation'
                    },
                    {
                        idx: 12,
                        title: 'Region'
                    },
                    {
                        idx: 13,
                        title: 'Solar System'
                    },
                    {
                        idx: 14,
                        title: 'Type'
                    },
                    {
                        idx: 15,
                        title: 'Reinforced?'
                    },
                    {
                        idx: 16,
                        title: 'State'
                    },
                    {
                        idx: 17,
                        title: 'Low Power?'
                    }
                ],
                bootstrap: true
            },

            createdRow: function( row, data, dataIndex ) 
            {
                if (data['is_reinforced'])
                {
                    $(row).addClass('danger');
                }               
            }
            
        });       
    });
{% endblock %}
